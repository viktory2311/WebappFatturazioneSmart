<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Fatturazione Smart</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
  {% load static %}
  <link rel="stylesheet" href="{% static 'style.css' %}">
</head>
<body class="p-0">

  <!-- HEADER -->
  <header class="app-header shadow-sm p-3 mb-4 bg-primary text-white d-flex align-items-center">
    <div class="logo me-3"><img src="{% static 'Assets/collaborative.png'%}"></img></div>
    <h1 class="m-0 fs-3" style="cursor:pointer" onclick="setActive(this,'upload')">Fatturazione Smart</h1>
  </header>
  <!-- MENU DI NAVIGAZIONE -->
  <nav class="mb-4 d-flex justify-content-center gap-2">
    <button class="btn btn-outline-light nav-btn" onclick="setActive(this,'upload')">ðŸ“‚ Upload</button>
    <button class="btn btn-outline-light nav-btn" onclick="setActive(this, 'dati')">ðŸ“Š Visualizza Dati</button>
    <button class="btn btn-outline-light nav-btn" onclick="setActive(this, 'fatture')">ðŸ§¾ Genera Fatture</button>
  </nav>

  <main class="container-fluid px-5">

    <!-- SEZIONE UPLOAD -->
      <div id="upload" class="page">

          <!-- OSS -->
        <div class="mb-4">
          <h2>Carica File CSV OSS</h2>
          <div class="border border-2 border-primary rounded p-5 text-center bg-light" style="cursor:pointer;">
            <div class="text-secondary">Trascina qui il file CSV/XLSX oppure <span class="text-primary fw-bold">clicca per selezionare</span></div>
            <input type="file" id="fileInput-oss" class="form-control d-none">
          </div>
          <button class="btn btn-primary mt-2" onclick="loadFile('oss')">Carica</button>
          <p class="mt-2 text-muted">Inserisci file OSS</p>
        </div>

        <!-- UMANA -->
        <div class="mb-4">
          <h2>Carica File CSV Umana</h2>
          <div class="border border-2 border-primary rounded p-5 text-center bg-light" style="cursor:pointer;">
            <div class="text-secondary">Trascina qui il file CSV/XLSX oppure <span class="text-primary fw-bold">clicca per selezionare</span></div>
            <input type="file" id="fileInput-umana" class="form-control d-none">
          </div>
          <button class="btn btn-primary mt-2" onclick="loadFile('umana')">Carica</button>
          <p class="mt-2 text-muted">Inserisci file Umana</p>
        </div>

        <!-- SINERGY -->
        <div class="mb-4">
          <h2>Carica File CSV Synergie</h2>
          <div class="border border-2 border-primary rounded p-5 text-center bg-light" style="cursor:pointer;">
            <div class="text-secondary">Trascina qui il file CSV/XLSX oppure <span class="text-primary fw-bold">clicca per selezionare</span></div>
            <input type="file" id="fileInput-synergie" class="form-control d-none">
          </div>
          <button class="btn btn-primary mt-2" onclick="loadFile('synergie')">Carica</button>
          <p class="mt-2 text-muted">Inserisci file Sinergy</p>
        </div>

        <!-- GiGROUP -->
        <div class="mb-4">
          <h2>Carica File CSV GiGroup</h2>
          <div class="border border-2 border-primary rounded p-5 text-center bg-light" style="cursor:pointer;">
            <div class="text-secondary">Trascina qui il file CSV/XLSX oppure <span class="text-primary fw-bold">clicca per selezionare</span></div>
            <input type="file" id="fileInput-gigroup" class="form-control d-none">
          </div>
          <button class="btn btn-primary mt-2" onclick="loadFile('gigroup')">Carica</button>
          <p class="mt-2 text-muted">Inserisci file GiGroup</p>
        </div>

      

      </div>


    <!-- SEZIONE DATI -->
  <div id="dati" class="page">
      <div class="d-flex" style="height:100vh;">  
      <!-- Sidebar Filtri -->
      <aside class="bg-light border-end p-3" style="width:280px;">
        <h5 class="mb-3"><i class="bi bi-funnel"></i> Filtri</h5>
        <!-- Ricerca -->
        <div class="mb-3">
          <label class="form-label">Cerca:</label>
          <input type="text" class="form-control" id="searchInput" placeholder="Cerca..." oninput="applyFilters()">
        </div>
        <!-- Filtri Select -->
        <div class="mb-3">
          <label class="form-label">Utente:</label>
          <select id="UtenteFilter" class="form-select" onchange="applyFilters()">
            <option value="">Tutti</option>
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label">Tipo Anziano:</label>
          <select id="filtertipoAnziano" class="form-select" onchange="applyFilters()">
            <option value="">Tutti</option>
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label">Distretto:</label>
          <select id="filterDistretto" class="form-select" onchange="applyFilters()">
            <option value="">Tutti</option>
          </select>
        </div>
        <!-- Checkbox -->
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" id="filterCheckboxadi" onchange="applyFilters()">
          <label class="form-check-label" for="filterCheckboxadi">C-ADI</label>
        </div>
        <div class="form-check mb-3">
          <input class="form-check-input" type="checkbox" id="filterCheckboxhcp" onchange="applyFilters()">
          <label class="form-check-label" for="filterCheckboxhcp">C-HCP</label>
        </div>
         <div class="form-check mb-3">
          <input class="form-check-input" type="checkbox" id="filterCheckboxgigroup" onchange="applyFilters()">
          <label class="form-check-label" for="filterCheckboxhcp">GiGroup</label>
        </div>
         <div class="form-check mb-3">
          <input class="form-check-input" type="checkbox" id="filterCheckboxsynergie" onchange="applyFilters()">
          <label class="form-check-label" for="filterCheckboxhcp">Synergie</label>
        </div>
         <div class="form-check mb-3">
          <input class="form-check-input" type="checkbox" id="filterCheckboxumana" onchange="applyFilters()">
          <label class="form-check-label" for="filterCheckboxhcp">Umana</label>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="flex-column">
        <!-- Top Bar -->
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h2 id ="labelAnteprimaDati" class="fw-bold">Anteprima Dati</h2><br>
          <h6 id ="totaleUtenti" class="fw-bold"></h6>
          <div>
            <button class="btn btn-outline-danger" onclick="resetData()">
              <i class="bi bi-arrow-counterclockwise"></i> Reset
            </button>
          </div>
        </div>

          <!-- Tabella scrollabile -->
          <div class="table-wrapper flex-grow-1" style="overflow:auto;">
            <table id="mainTable" class="table table-bordered table-hover table-rounded">
              <thead class="table-dark">
                <tr>
                  <th class="text-center">UTENTE</th>
                  <th class="text-center">DATA DI NASCITA</th>
                  <th class="text-center">INDIRIZZO</th>
                  <th class="text-center">CODICE FISCALE</th>
                  <th class="text-center">C - ADI</th>
                  <th class="text-center">C - Anziano autosufficiente</th>
                  <th class="text-center">C - Anziano non autosufficiente</th>
                  <th class="text-center">C - Contratti privati</th>
                  <th class="text-center">C - Disabile</th>
                  <th class="text-center">C - DISTRETTO NORD</th>
                  <th class="text-center">C - DISTRETTO SUD</th>
                  <th class="text-center">C - EMERGENZA CALDO ASL</th>
                  <th class="text-center">C - EMERGENZA CALDO COMUNE</th>
                  <th class="text-center">C - HCP</th>
                  <th class="text-center">C - Minori Disabili Gravi</th>
                  <th class="text-center">C - Nord Ovest</th>
                  <th class="text-center">C - PNRR</th>
                  <th class="text-center">C - Progetto SOD</th>
                  <th class="text-center">C - Sud-Est</th>
                  <th class="text-center">C - Sud-Ovest</th>
                  <th class="text-center">C - UFFICIO VIA TESSO</th>
                  <th class="text-center">TIPOLOGIA</th>
                  <th class="text-center">APL</th>
                  <th class="text-center">TOTALE ORE MESE</th>
                </tr>
              </thead>
              <tbody id="dataTable">
                <tr><td colspan="22" class="text-center">Nessun dato caricato</td></tr>
              </tbody>
            </table>
  </div>
        <button class="btn btn-primary mt-3"><i class="bi bi-plus-circle"></i> Aggiungi Dato</button>
      </main>
    </div>
  </div>

    <!-- SEZIONE FATTURE -->
      <div id="fatture" class="page active">
        <h2>ðŸ’° Prezzi aggiornati</h2>

  <table id="tabella-prezzi" class="table table-bordered table-striped">
    <thead class="table-dark">
      <tr>
        <th>Prestazione</th>
        <th>Prezzo (â‚¬)</th>
      </tr>
    </thead>
    <tbody>
        <tr>
        <td>Istruttore</td>
        <td contenteditable="true" data-prestazione="ISTRUTTORE" data-apl="gigroup" onblur="validateNumberInput(this)"></td>
      </tr>
      <tr>
        <td>Baby Sitter</td>
        <td contenteditable="true" data-prestazione="BABY SITTER" data-apl="gigroup" onblur="validateNumberInput(this)"></td>
      </tr>
      <tr>
        <td>Synergie</td>
        <td contenteditable="true" data-prestazione="AF" data-apl="synergie" onblur="validateNumberInput(this)"></td>
      </tr>
      <tr>
        <td>Gigroup</td>
        <td contenteditable="true" data-prestazione="AF" data-apl="gigroup" onblur="validateNumberInput(this)"></td>
      </tr>
      <tr>
        <td>Umana</td>
        <td contenteditable="true" data-prestazione="AF" data-apl="umana" onblur="validateNumberInput(this)"></td>
      </tr>
      <tr>
        <td>OSS</td>
        <td contenteditable="true" data-prestazione="OSS" data-apl="" onblur="validateNumberInput(this)"></td>
      </tr>
    </tbody>
  </table>

  <button class="btn btn-success mt-2" onclick="salvaTariffe()">ðŸ’¾ Salva Prezzi</button>
  <br>
  <br>
  <br>
    <h2>Genera Fattura:</h2>

    <!-- Selezione tipo fattura -->
    <div class="fattura-options">
      <button class="btn btn-info " onclick="setFattura('anziani_non_autosufficienti')">Anziani non Autosufficienti</button>
      <button class="btn btn-info" onclick="setFattura('anziani_autosufficienti')">Anziani Autosufficienti</button>
      <button class="btn btn-info" onclick="setFattura('disabili')">Disabili</button>
      <button class="btn btn-info" onclick="setFattura('minori_disabili_gravi')">Minori disabili gravi</button>
      <button class="btn btn-info" onclick="setFattura('emergenza_caldo')">Emergenza caldo</button>
      <button class="btn btn-info" onclick="setFattura('minori_non_disabili')">Minori non Disabili</button>
      <button class="btn btn-info" onclick="setFattura('Tutte le categorie')">Tutte le categorie</button>

    </div>

    <!-- Descrizione dei parametri -->
    <div id="fattura-description" class="mt-3">
      <p class="text-muted">Seleziona un tipo di fattura per vedere i parametri.</p>
    </div>

    <!-- Bottone per esportare Excel -->
    <button class="btn btn-warning mt-3" onclick="exportExcel()">ðŸ“Š Esporta Excel</button>
  </div>


  </main>
  <!-- PapaParse -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/exceljs/dist/exceljs.min.js"></script>
  <script src="{% static 'script.js' %}"></script>
</body>
</html>
	